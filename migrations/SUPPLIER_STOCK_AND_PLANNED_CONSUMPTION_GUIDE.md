# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: –û—Å—Ç–∞—Ç–∫–∏ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∏ –ø–ª–∞–Ω–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
1. **–û—Å—Ç–∞—Ç–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤** - –º–∞—Ç–µ—Ä–∏–∞–ª—ã –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–∞—à–∏—Ö —Å–∫–ª–∞–¥–∞—Ö, –Ω–æ –∏ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
2. **–ü–ª–∞–Ω–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ –¥–∞—Ç–∞–º

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `warehouses`

–¢–∞–±–ª–∏—Ü–∞ `warehouses` —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
- `type` - —Ç–∏–ø –ª–æ–∫–∞—Ü–∏–∏: `'internal'` (–Ω–∞—à —Å–∫–ª–∞–¥), `'supplier'` (—É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞), `'contractor'` (—É –ø–æ–¥—Ä—è–¥—á–∏–∫–∞)
- `contractor_id` - ID –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞/–ø–æ–¥—Ä—è–¥—á–∏–∫–∞ (–µ—Å–ª–∏ `type = 'supplier'` –∏–ª–∏ `'contractor'`)

### 2. –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `planned_consumption`

–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–æ–≤—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:
- `item_id` - ID –º–∞—Ç–µ—Ä–∏–∞–ª–∞
- `planned_date` - –¥–∞—Ç–∞ –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞ (YYYY-MM-DD)
- `quantity` - –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- `notes` - –ø—Ä–∏–º–µ—á–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é

–û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
-- –§–∞–π–ª: migrations/add_supplier_stock_and_planned_consumption.sql
```

–≠—Ç–æ –¥–æ–±–∞–≤–∏—Ç:
- –ü–æ–ª—è `type` –∏ `contractor_id` –≤ —Ç–∞–±–ª–∏—Ü—É `warehouses`
- –¢–∞–±–ª–∏—Ü—É `planned_consumption` –¥–ª—è –ø–ª–∞–Ω–æ–≤—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ —Å–∫–ª–∞–¥—ã —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞, —É –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –º–∞—Ç–µ—Ä–∏–∞–ª—ã, —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å –≤ `warehouses`:

```sql
-- –ü—Ä–∏–º–µ—Ä: –°–∫–ª–∞–¥ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ "–î–Ω—ñ–ø—Ä–æ–ª–∞–∫"
INSERT INTO warehouses (id, name, location, type, contractor_id)
VALUES (
    'wh-supplier-dniprolak',
    '–°–∫–ª–∞–¥ —É –î–Ω—ñ–ø—Ä–æ–ª–∞–∫',
    '–£ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –î–Ω—ñ–ø—Ä–æ–ª–∞–∫',
    'supplier',
    'supplier-dniprolak'  -- ID –∏–∑ —Ç–∞–±–ª–∏—Ü—ã contractors
)
ON CONFLICT (id) DO UPDATE SET
    name = EXCLUDED.name,
    location = EXCLUDED.location,
    type = EXCLUDED.type,
    contractor_id = EXCLUDED.contractor_id;
```

### –®–∞–≥ 3: –ò–º–ø–æ—Ä—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤

–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∏–∑ Excel, –µ—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤:

1. **–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Excel –∏–º–ø–æ—Ä—Ç (–±—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è)**
   - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –∫–æ–ª–æ–Ω–∫–∏ —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
   - –°–æ–∑–¥–∞—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–ø–∏—Å–∏ –≤ `warehouses` –∏ `stock_levels`

2. **–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ SQL (—Ä—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç)**
   ```sql
   -- –ü—Ä–∏–º–µ—Ä: –î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
   INSERT INTO stock_levels (item_id, warehouse_id, quantity)
   VALUES (
       '2010247',  -- ID –º–∞—Ç–µ—Ä–∏–∞–ª–∞ (–∞—Ä—Ç–∏–∫—É–ª)
       'wh-supplier-dniprolak',  -- ID —Å–∫–ª–∞–¥–∞ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
       1000  -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
   )
   ON CONFLICT (item_id, warehouse_id) DO UPDATE SET
       quantity = EXCLUDED.quantity;
   ```

### –®–∞–≥ 4: –ü–ª–∞–Ω–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞–Ω–æ–≤—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ API –∏–ª–∏ SQL:

```sql
-- –ü—Ä–∏–º–µ—Ä: –ü–ª–∞–Ω–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –Ω–∞ 01.12.2025
INSERT INTO planned_consumption (item_id, planned_date, quantity, notes)
VALUES (
    '2010247',  -- ID –º–∞—Ç–µ—Ä–∏–∞–ª–∞
    '2025-12-01',  -- –î–∞—Ç–∞
    500,  -- –ü–ª–∞–Ω–∏—Ä—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    '–ü–ª–∞–Ω –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –Ω–∞ –¥–µ–∫–∞–±—Ä—å'
)
ON CONFLICT (item_id, planned_date) DO UPDATE SET
    quantity = EXCLUDED.quantity,
    notes = EXCLUDED.notes;
```

## –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –°–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

–í —Ç–∞–±–ª–∏—Ü–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:
- **–°—Ç–æ–ª–±–µ—Ü "–ú–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ"** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–µ–π–¥–∂–∏ —Å –ª–æ–∫–∞—Ü–∏—è–º–∏:
  - üü¢ **–°–ö–õ–ê–î** - –Ω–∞—à —Å–∫–ª–∞–¥ (–∑–µ–ª–µ–Ω—ã–π)
  - üîµ **–í –¶–ï–•–£** - –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∫–ª–∞–¥ (—Å–∏–Ω–∏–π)
  - üü° **–£ –ü–û–î–†–Ø–î–ß–ò–ö–ê** - —É –ø–æ–¥—Ä—è–¥—á–∏–∫–∞ (–∂–µ–ª—Ç—ã–π)
  - üü£ **–£ –ü–û–°–¢–ê–í–©–ò–ö–ê** - —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)

- **–°—Ç–æ–ª–±–µ—Ü "–û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫"** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º—É –≤—Å–µ—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤–æ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö (–≤–∫–ª—é—á–∞—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤)

### –î–µ—Ç–∞–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞

–ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å:
- –î–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Å—Ç–∞—Ç–∫–∞—Ö –ø–æ –∫–∞–∂–¥–æ–π –ª–æ–∫–∞—Ü–∏–∏
- –ü–ª–∞–Ω–æ–≤—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏ (–±—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è)

## –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞—Ä—Ç–æ–Ω–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–∏

–î–ª—è –≥—Ä—É–ø–ø—ã "–∫–∞—Ä—Ç–æ–Ω–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞" —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏ –≤ —Ç—Ä–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö:

```sql
-- 1. –ú–∞—Ç–µ—Ä–∏–∞–ª
INSERT INTO items (id, sku, name, category, unit, min_stock_level)
VALUES (
    '2010247',
    '2010247',
    '–ö–æ—Ä–æ–±–∫–∞ –¥–ª—è —á–∞—é 150x41x61–º–º',
    'packaging_box',
    'pcs',
    0
);

-- 2. –û—Å—Ç–∞—Ç–∫–∏ –≤ —Ç—Ä–µ—Ö –ª–æ–∫–∞—Ü–∏—è—Ö
-- –ù–∞ –Ω–∞—à–µ–º —Å–∫–ª–∞–¥–µ
INSERT INTO stock_levels (item_id, warehouse_id, quantity)
VALUES ('2010247', 'wh-main', 1000);

-- –£ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ 1
INSERT INTO stock_levels (item_id, warehouse_id, quantity)
VALUES ('2010247', 'wh-supplier-dniprolak', 5000);

-- –£ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ 2
INSERT INTO stock_levels (item_id, warehouse_id, quantity)
VALUES ('2010247', 'wh-supplier-tempo', 3000);

-- 3. –ü–ª–∞–Ω–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥ –Ω–∞ 01.12.2025
INSERT INTO planned_consumption (item_id, planned_date, quantity)
VALUES ('2010247', '2025-12-01', 2000);
```

## –ò–º–ø–æ—Ä—Ç –∏–∑ Excel

–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∏–∑ Excel —Å–∏—Å—Ç–µ–º–∞:
1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ—Å—Ç–∞—Ç–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–∫–ª–∞–¥–∞—Ö (wh-main, wh-prod-1)
3. **–ë—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç –∫–æ–ª–æ–Ω–∫–∏ —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∏ —Å–æ–∑–¥–∞—Å—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Å–∫–ª–∞–¥–æ–≤ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤:** –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–∫–ª–∞–¥ —Ç–∏–ø–∞ `'supplier'`
2. **–ü–ª–∞–Ω–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã:** –û–¥–∏–Ω –º–∞—Ç–µ—Ä–∏–∞–ª –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–ª–∞–Ω–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –æ–¥–Ω—É –¥–∞—Ç—É (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á: `item_id + planned_date`)
3. **–£–¥–∞–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã

## SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```sql
-- –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–∫–ª–∞–¥—ã —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
SELECT w.id, w.name, w.type, c.name as supplier_name
FROM warehouses w
LEFT JOIN contractors c ON w.contractor_id = c.id
WHERE w.type = 'supplier' OR w.type = 'contractor';

-- –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —É –≤—Å–µ—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
SELECT 
    i.sku,
    i.name,
    w.name as location,
    c.name as supplier_name,
    sl.quantity
FROM stock_levels sl
JOIN items i ON sl.item_id = i.id
JOIN warehouses w ON sl.warehouse_id = w.id
LEFT JOIN contractors c ON w.contractor_id = c.id
WHERE w.type = 'supplier'
ORDER BY i.name, w.name;

-- –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞–Ω–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –º–∞—Ç–µ—Ä–∏–∞–ª–∞
SELECT 
    i.sku,
    i.name,
    pc.planned_date,
    pc.quantity,
    pc.notes
FROM planned_consumption pc
JOIN items i ON pc.item_id = i.id
WHERE i.id = '2010247'  -- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ ID –º–∞—Ç–µ—Ä–∏–∞–ª–∞
ORDER BY pc.planned_date;
```


